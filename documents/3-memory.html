<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Memory & Tools: Purpose & Flow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            background-color: #1F2937; /* bg-gray-800 */
            border: 1px solid #374151; /* border-gray-700 */
            border-radius: 0.75rem; /* rounded-xl */
            padding: 1.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(34, 211, 238, 0.1), 0 4px 6px -2px rgba(34, 211, 238, 0.05);
        }
        .code-block {
            background-color: #111827; /* bg-gray-900 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            font-family: monospace;
            font-size: 0.875rem; /* text-sm */
            overflow-x: auto;
            color: #d1d5db; /* text-gray-300 */
        }
        .arrow {
            font-size: 2.5rem;
            color: #4B5563; /* text-gray-600 */
            margin: 1.5rem 0;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="container mx-auto p-4 sm:p-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-sky-400">
                ⚙️ Agent Memory & Tools: Purpose & Flow
            </h1>
            <p class="text-lg text-gray-400 max-w-3xl mx-auto">
                This Colab notebook demonstrates how an AI agent can use custom tools to read from and write to its own memory, enabling it to perform complex, stateful tasks like managing a to-do list.
            </p>
        </header>

        <div class="space-y-6">

            <!-- Step 1: User Request -->
            <div class="card">
                <div class="flex items-center mb-4">
                    <div class="bg-sky-500/20 p-3 rounded-lg mr-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold text-white">1. The User's Request: Add Tasks</h2>
                        <p class="text-gray-400">The process starts when the user asks the agent to remember several tasks.</p>
                    </div>
                </div>
                <div class="code-block">
<pre><code><span class="text-cyan-400">user_message</span> = "Add 'start calling me Charles' and 'tell me a haiku...' as tasks."</code></pre>
                </div>
            </div>

            <div class="arrow">↓</div>

            <!-- Step 2: The AI's Decision -->
            <div class="card">
                <div class="flex items-center mb-4">
                    <div class="bg-purple-500/20 p-3 rounded-lg mr-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold text-white">2. The AI's Decision: Call `task_queue_push`</h2>
                        <p class="text-gray-400">The Gemini model understands it needs to add items to a list and decides to call its `task_queue_push` tool for each task.</p>
                    </div>
                </div>
                <div class="code-block">
<pre><code><span class="text-gray-500">// Model's output is a series of function calls</span>
{ "function_call": { "name": "task_queue_push", "args": { "task_description": "Start calling the user Charles." } } }
{ "function_call": { "name": "task_queue_push", "args": { "task_description": "Tell a haiku about the name Charles." } } }
</code></pre>
                </div>
            </div>
            
            <div class="arrow">↓</div>

            <!-- Step 3: Memory Write -->
            <div class="card">
                <div class="flex items-center mb-4">
                     <div class="bg-emerald-500/20 p-3 rounded-lg mr-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" /></svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold text-white">3. Memory Write: The Core Logic</h2>
                        <p class="text-gray-400">The `_task_queue_push_impl` function modifies the agent's state.</p>
                    </div>
                </div>
                <p class="mb-4 text-gray-300">For each tool call, the system executes the corresponding Python function. This function reads the current `tasks` list from the agent's `memory_blocks`, appends the new task, and saves the updated list back into the agent's memory.</p>
                 <div class="code-block">
<pre><code><span class="text-gray-500">// 1. Get current memory</span>
tasks = agent.memory_blocks["tasks"]  <span class="text-gray-500">// -> []</span>
<span class="text-gray-500">// 2. Append new task</span>
tasks.append("Start calling the user Charles.")
<span class="text-gray-500">// 3. Update memory</span>
agent.memory_blocks["tasks"] = tasks <span class="text-gray-500">// -> ["Start calling the user Charles."]</span></code></pre>
                </div>
            </div>

            <div class="arrow">↓</div>

            <!-- Step 4: Second User Request -->
            <div class="card">
                <div class="flex items-center mb-4">
                    <div class="bg-sky-500/20 p-3 rounded-lg mr-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold text-white">4. The User's Second Request: Complete Tasks</h2>
                        <p class="text-gray-400">The user now asks the agent to act on its stored tasks.</p>
                    </div>
                </div>
                 <div class="code-block">
<pre><code><span class="text-cyan-400">user_message</span> = "Okay, please complete your tasks now."</code></pre>
                </div>
            </div>

            <div class="arrow">↓</div>

            <!-- Step 5: Memory Read -->
            <div class="card">
                <div class="flex items-center mb-4">
                     <div class="bg-purple-500/20 p-3 rounded-lg mr-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"></path><path d="M14 2v6h6"></path><path d="M16 13H8"></path><path d="M16 17H8"></path><path d="M10 9H8"></path></svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold text-white">5. Memory Read & Update: `task_queue_pop`</h2>
                        <p class="text-gray-400">The AI calls its `task_queue_pop` tool to retrieve and process each task.</p>
                    </div>
                </div>
                <p class="mb-4 text-gray-300">The `_task_queue_pop_impl` function reads the `tasks` list, removes the first item, and saves the shortened list back to memory. The content of the removed task is returned to the model as context for its next step.</p>
            </div>

            <div class="arrow">↓</div>

            <!-- Step 6: The Final Answer -->
            <div class="card">
                <div class="flex items-center mb-4">
                     <div class="bg-rose-500/20 p-3 rounded-lg mr-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-rose-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.196-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.783-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" /></svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold text-white">6. The Final Answer</h2>
                        <p class="text-gray-400">The agent generates a creative response based on its completed tasks.</p>
                    </div>
                </div>
                <p class="mb-4 text-gray-300">After the task queue is empty, the agent has the full context of what it has accomplished. It then generates a final, summary response for the user, which includes the haiku it was asked to create.</p>
            </div>

        </div>
    </div>

</body>
</html>
